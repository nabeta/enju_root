<div id="main">
<h1 class="title"><%= t('page.edit_user_profile', :login_name => @user.login) -%></h1>
<div class="inner">

<%= error_messages_for :user -%>

<%- form_for(@user, :url => user_path(@user.login)) do |f| -%>

  <%= render :partial => 'users/edit_credential', :locals => {:f => f} -%>
  
<p style="clear: both">
  <p>
    <b><%= t('activerecord.attributes.user.keyword_list') -%></b><br />
    <%= f.text_area :keyword_list, :class => 'resource_textarea' -%>
  </p>

  <p>
    <b><%= t('user.reset_checkout_icalendar_url') -%></b><br />
    <div id="feed_token">
      <%- if @user.checkout_icalendar_token -%>
        <%= link_to checkouts_url(:icalendar_token => @user.checkout_icalendar_token, :format => :ics), checkouts_url(:icalendar_token => @user.checkout_icalendar_token, :format => :ics) -%>
        <%= f.hidden_field :checkout_icalendar_token -%>
      <%- end -%>
      <br />
      <%= button_to_remote t('page.reset'), :update => 'feed_token', :url => edit_user_path(@user.login, :mode => 'feed_token'), :method => :get -%>
      <%= button_to_remote t('page.delete'), :update => 'feed_token', :url => edit_user_path(@user.login, :mode => 'feed_token', :disable => true), :method => :get -%>
    </div>
    <br />
  </p>

  <p>
    <b><%= t('activerecord.attributes.user.note') -%></b><br />
    <%= f.text_area :note, :class => 'resource_textarea' -%>
  </p>

  <!--
  <h1 class="title"><%= t('page.history') -%></h1>
  <p>
    <%= f.check_box :save_search_history -%> <%= ('Save search history') -%>
  </p>

  <p>
    <%= f.check_box :save_checkout_history -%> <%= ('Save checkout history') -%>
  </p>
  -->
  <p>
    <%= f.submit t('page.update'), :confirm => t('page.are_you_sure') -%>
  </p>

  <%- end -%>

</div>
</div>

<div id="sidebar">
  <ul>
    <%- if @user.patron -%>
      <li><%= link_to t('user.patron_profile'), @user.patron -%></li>
    <%- else -%>
      <li><%= link_to t('user.patron_profile'), new_user_patron_path(@user.login) -%></li>
    <%- end -%>
    <%- if current_user.has_role?('Librarian') -%>
      <%- unless current_user == @user -%>
        <li><%= link_to t('page.destroy'), user_path(@user.login), :confirm => t('page.are_you_sure'), :method => :delete -%></li>
      <%- end -%>
    <%- end -%>
  </ul>
</div>
