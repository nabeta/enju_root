<div style="color: red"><%=h flash[:message] -%></div>

<div id="sidebar">
  <%= render :partial => 'manifestations/book_jacket', :locals => {:manifestation => @item.manifestation} -%>
  <ul>
    <%- if @shelf -%>
      <li><%= link_to t('page.edit'), edit_library_shelf_item_path(@shelf.library, @shelf, @item) -%></li>
    <%- else -%>
      <li><%= link_to t('page.edit'), edit_item_path(@item) -%></li>
    <%- end -%>
    <li><%= link_to t('page.listing', :model => t('activerecord.models.inter_library_loan')), item_inter_library_loans_path(@item) -%></li>
    <li><%= link_to t('page.add_derivation'), item_items_path(@item) -%></li>
    <li><%= link_to t('page.back'), items_path -%></li>
    <li><%= link_to t('page.destroy'), @item, :confirm => t('page.are_you_sure'), :method => :delete -%></li>
    <%- if @item.inter_library_loans.empty? -%>
      <li><%= link_to t('item.add_new_copy'), new_manifestation_item_path(@item.manifestation) -%></li>
    <%- end -%>
  </ul>
</div>

<div id="main">
<h1 class="title"><%= t('page.showing', :model => t('activerecord.models.item')) -%></h1>
<div class="inner">
  <%- if @item.manifestation -%>
    <%= render :partial => 'manifestations/title', :locals => {:manifestation => @item.manifestation} -%>
  <%- end -%>

<p>
  <b><%= t('activerecord.models.shelf') -%>:</b>
  <%= link_to h(@item.shelf.display_name.localize), shelf_path(@item.shelf_id) -%>
  <%= render :partial => 'items/shelf_picture', :locals => {:item => @item} -%>
  (<%= link_to h(@item.shelf.library.display_name.localize), library_path(@item.shelf.library.name) -%>)
</p>

<p>
  <b><%= t('activerecord.attributes.item.checkout_type') -%>:</b>
  <%= link_to h(@item.checkout_type.display_name.localize), @item.checkout_type -%>
</p>

<p>
  <b><%= t('activerecord.models.circulation_status') -%>:</b>
  <%= link_to h(@item.circulation_status.display_name.localize), @item.circulation_status -%>
  <%- if logged_in? -%>
    <%- if current_user.has_role?('Librarian') -%>
      <%- unless @item.checkouts.not_returned.blank? -%>
        (<%= link_to t('item.current_checkout'), user_checkout_path(@item.checkouts.not_returned.first.user.login, @item.checkouts.not_returned.first) -%>)
      <%- end -%>
    <%- end -%>
  <%- end -%>
</p>

<p>
  <b><%= t('activerecord.attributes.item.call_number') -%>:</b>
  <%=h @item.call_number -%>
</p>

<p>
  <b><%= t('activerecord.attributes.item.item_identifier') -%>:</b>
  <%=h @item.item_identifier -%>
  <br />
  <%= image_tag("#{barcode_url(@item.barcode)}.png", :alt => @item.item_identifier) if @item.barcode -%>
</p>

<p>
  <b><%= t('activerecord.attributes.item.price') -%>:</b>
  <%=h @item.price -%>
</p>

<p>
  <b><%= t('activerecord.attributes.item.url') -%>:</b>
  <%=h @item.url -%>
</p>

<p>
  <b><%= t('activerecord.attributes.item.include_supplements') -%>:</b>
  <%- if @item.include_supplements -%>
    <%= ('Yes') -%>
  <%- else -%>
    <%= ('No') -%>
  <%- end -%>
</p>

<!--
<p>
  <b><%= t('activerecord.models.use_restriction') -%>:</b>
  <ul>
    <%- @item.use_restrictions.each do |use_restriction| -%>
      <li><%= link_to h(use_restriction.display_name.localize), use_restriction_path(use_restriction) -%></li>
    <%- end -%>
  </ul>
</p>
-->

<%- cache(:id => @item.id, :action => :show, :controller => :items, :editable => @item.is_updatable_by(current_user), :locale => @locale) do -%>
<%- if @item.is_updatable_by(current_user) -%>
  <p>
    <b><%= t('item.donor') -%>:</b>
    <%- @item.donors.each do |patron| -%>
      <%= link_to h(patron.full_name), patron -%>
    <%- end -%>
  </p>
<%- end -%>

<p>
  <b><%= t('page.created_at') -%>:</b>
  <%= l(@item.created_at) -%>
</p>

<p>
  <b><%= t('page.updated_at') -%>:</b>
  <%= l(@item.updated_at) -%>
</p>
<%- end -%>
</div>
</div>
